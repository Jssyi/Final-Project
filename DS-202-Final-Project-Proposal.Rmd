---
title: "DS 202 Final Project Proposal"
author: "Jesse Dolan, Bela Banegas, Jennifer Godbersen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Research Project Title: Data Science Salaries

This data set includes information about data science salaries. Variables include: year, experience level, employment type (full-time, part-time, contract, freelance), job title, salary, salary currency, salary in usd, employee residence, remote ratio (amount of work done remotely), and company location.

```{r}
file_path <- "salaries.csv"

df <- read.csv(file_path)

head(df)

```

Data cleaning steps: There do not appear to be any empty rows or NA values.

```{r}
empty_rows <- df[!complete.cases(df), ]
if (any(is.na(df))) {
  print("There are NA values in the dataframe.")
} else {
  print("There are no NA values in the dataframe.")
}
```

Our current project idea is to identify the current salaries for people in our field. Particular variables of interest are year, experience level, job title, remote work ratio, and company location.

We will be exploring the following relationships:

-   Salary over time (Bela)

```{r echo=TRUE}
library(ggplot2)
library(dplyr)
# Group by year and calculate the mean salary
salary_over_time <- df %>%
  group_by(work_year) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )

# Plotting
ggplot(salary_over_time, aes(x = work_year, y = mean_salary)) +
  geom_line(color = "blue") +
  geom_point(color = "blue") +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary Over Time",
    x = "Year",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma)  # for readability use comma format
```

-   Salary by company size (Bela)

```{r echo=TRUE}
library(ggplot2)
library(dplyr)
# Group by year and company size, and calculate the mean salary
salary_over_time <- df %>%
  group_by(work_year, company_size) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )

# Define colors and labels for each company size
company_size_labels <- c("small" = "Small", "medium" = "Medium", "large" = "Large")
company_size_colors <- c("small" = "blue", "medium" = "red", "large" = "yellow")


ggplot(salary_over_time, aes(x = work_year, y = mean_salary, color = company_size, linetype = company_size)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary Over Time by Company Size",
    x = "Year",
    y = "Mean Salary ($)",
    color = "Company Size",
    linetype = "Company Size"
  ) +
  scale_color_manual(values = company_size_colors, labels = company_size_labels) +
  scale_linetype_manual(values = c("solid", "dashed", "dotted"), labels = company_size_labels) +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma)  
```

-   Salary by job title (Jennifer)

-   Salary by remote ratio (Jennifer)

-   Salary by location - country (Jesse)

```{r echo=TRUE, fig.height=6, fig.width=12}
# Load necessary libraries
library(ggplot2)
library(dplyr)

# Group by unique company_location and calculate the mean salary
salary_summary <- df %>%
  group_by(company_location) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )


ggplot(salary_summary, aes(x = company_location, y = mean_salary)) +
  geom_bar(stat = "identity", fill = "green", color = "black", width = 0.7) +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary by Unique Company Location",
    x = "Company Location",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format

```

-   Salary by experience (Jesse)

```{r echo=TRUE, fig.height=6, fig.width=12}
# Load necessary libraries
library(ggplot2)
library(dplyr)

# Group by unique company_location and calculate the mean salary
salary_summary <- df %>%
  group_by(experience_level) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )
df <- df %>%
  mutate(experience_level = case_when(
    experience_level == "EN" ~ "Entry-Level",
    experience_level == "EX" ~ "Executive",
    experience_level == "SE" ~ "Senior",
    experience_level == "MI" ~ "Mid-Level",
    TRUE ~ experience_level  # Default if no match
  ))

ggplot(salary_summary, aes(x = experience_level, y = mean_salary)) +
  geom_bar(stat = "identity", fill = "red", color = "black", width = 0.7) +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary by Experience Level",
    x = "Experience Level",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format

```

```{r echo=TRUE, message=TRUE, warning=TRUE}
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(tidyr)

# Calculate unique job titles with count > 50
unique_job_titles <- df %>%
  filter(!is.na(job_title)) %>%  # Filter out missing values
  group_by(job_title) %>%
  summarize(job_count = n()) %>%
  filter(job_count > 50) %>%
  pull(job_title)  # Extract unique job titles as vector

# Filter the original dataframe for plotting
df_filtered <- df %>%
  filter(!is.na(job_title)) %>%  # Filter out missing values
  filter(job_title %in% unique_job_titles)

# Create the plot using the filtered dataframe
ggplot(df_filtered, aes(x = job_title, y = salary_in_usd)) +
  geom_boxplot(fill = "skyblue", color = "black", outlier.shape = NA) +  # Use geom_boxplot to create boxplots
  geom_jitter(data = df_filtered %>% filter(salary_in_usd < quantile(salary_in_usd, 0.25) - 1.5*IQR(salary_in_usd) | salary_in_usd > quantile(salary_in_usd, 0.75) + 1.5*IQR(salary_in_usd)), width = 0.2, color = "black", alpha = 0.5) +
  geom_hline(yintercept = median(df_filtered$salary_in_usd), color = "red", linetype = "dashed") +  # Add a dashed line for median
  labs(
    title = "Salary Distribution by Job Title",
    x = "Job Title",
    y = "Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format


```

```{r echo=TRUE}

# Load necessary library
library(ggplot2)
library(scales)

df$remote_ratio <- factor(df$remote_ratio, levels = c(0, 50, 100))

# Get frequencies of unique values in the remote_ratio column
remote_ratio_frequency <- table(df$remote_ratio)

# Get frequencies of unique values in the remote_ratio column
remote_ratio_frequency <- table(df$remote_ratio)

# Convert the frequency table to a dataframe
remote_ratio_df <- as.data.frame(remote_ratio_frequency)

# Rename the columns for clarity
names(remote_ratio_df) <- c("Remote Ratio", "Frequency")

# Histogram of Remote Ratio
ggplot(remote_ratio_df, aes(x = `Remote Ratio`, y = Frequency)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(
    title = "Histogram of Remote Ratio",
    x = "Remote Ratio (%)",
    y = "Count (# of entries)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability


# Calculate count of jobs for each combination of time and remote_ratio
job_counts <- aggregate(job_title ~ work_year + remote_ratio, data = df, FUN = length)

# Plot
ggplot(job_counts, aes(x = work_year, y = job_title, group = remote_ratio, color = remote_ratio)) +
  geom_line() +
  geom_point() +
  labs(title = "Number of Jobs by Remote Ratio Over Time",
       x = "Year",
       y = "Number of Jobs",
       color = "Remote Ratio") +
  scale_color_manual(values = c("red", "green", "skyblue")) +
  theme_minimal()

# Convert remote_ratio to factor to treat it as a categorical variable
df$remote_ratio <- factor(df$remote_ratio)

# Convert time to factor if it's not already
df$work_year <- as.factor(df$work_year)
df$work_year <- factor(df$work_year, levels = c("2020", "2021", "2022", "2023", "2024"))

# Calculate average salary for each combination of time and remote_ratio
average_salary <- aggregate(salary_in_usd ~ work_year + remote_ratio, data = df, FUN = median)


# Average Salary by Remote Ratio Over Time
ggplot(average_salary, aes(x = work_year, y = salary_in_usd, group = remote_ratio, color = remote_ratio)) +
  geom_line() +
  geom_point() +
  labs(title = "Median Salary by Remote Ratio Over Time",
       x = "Year",
       y = "Median Salary (USD)",
       color = "Remote Ratio") +
  scale_color_manual(values = c("red", "green", "skyblue")) +
  theme_minimal()

# Create the box plot with faceting
ggplot(df, aes(x = "", y = salary_in_usd)) +
  geom_boxplot(fill = "skyblue", color = "black") +
  facet_wrap(~ remote_ratio, scales = "free_x", nrow = 1) +
  labs(
    title = "Salary Distribution by Remote Ratio",
    x = "Remote Ratio (%)", 
    y = "Salary ($)"
  ) + scale_y_continuous(labels = function(x) format(x, scientific = FALSE))


```
