---
title: "DS 202 Final Project Proposal"
author: "Jesse Dolan, Bela Banegas, Jennifer Godbersen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Research Project Title: Data Science Salaries

This data set includes information about data science salaries. Variables include: year, experience level, employment type (full-time, part-time, contract, freelance), job title, salary, salary currency, salary in usd, employee residence, remote ratio (amount of work done remotely), and company location.

```{r}
file_path <- "salaries.csv"

df <- read.csv(file_path)

head(df)

```

Data cleaning steps: There do not appear to be any empty rows or NA values.

```{r}
empty_rows <- df[!complete.cases(df), ]
if (any(is.na(df))) {
  print("There are NA values in the dataframe.")
} else {
  print("There are no NA values in the dataframe.")
}
```

Our current project idea is to identify the current salaries for people in our field. Particular variables of interest are year, experience level, job title, remote work ratio, and company location.

We will be exploring the following relationships:

-   Salary over time (Bela)

```{r echo=TRUE}
library(ggplot2)
library(dplyr)
# Group by year and calculate the mean salary
salary_over_time <- df %>%
  group_by(work_year) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )

# Plotting
ggplot(salary_over_time, aes(x = work_year, y = mean_salary)) +
  geom_line(color = "blue") +
  geom_point(color = "blue") +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary Over Time",
    x = "Year",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma)  # for readability use comma format
```

-   Salary by company size (Bela)

```{r echo=TRUE}
library(ggplot2)
library(dplyr)
# Group by year and company size, and calculate the mean salary
salary_over_time <- df %>%
  group_by(work_year, company_size) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )

# Define colors and labels for each company size
company_size_labels <- c("small" = "Small", "medium" = "Medium", "large" = "Large")
company_size_colors <- c("small" = "blue", "medium" = "red", "large" = "yellow")


ggplot(salary_over_time, aes(x = work_year, y = mean_salary, color = company_size, linetype = company_size)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary Over Time by Company Size",
    x = "Year",
    y = "Mean Salary ($)",
    color = "Company Size",
    linetype = "Company Size"
  ) +
  scale_color_manual(values = company_size_colors, labels = company_size_labels) +
  scale_linetype_manual(values = c("solid", "dashed", "dotted"), labels = company_size_labels) +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma)  
```

-   Salary by job title (Jennifer)

-   Salary by remote ratio (Jennifer)

-   Salary by location - country (Jesse)

```{r echo=TRUE, fig.height=6, fig.width=12}
# Load necessary libraries
library(ggplot2)
library(dplyr)

# Group by unique company_location and calculate the mean salary
salary_summary <- df %>%
  group_by(company_location) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )


ggplot(salary_summary, aes(x = company_location, y = mean_salary)) +
  geom_bar(stat = "identity", fill = "green", color = "black", width = 0.7) +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary by Unique Company Location",
    x = "Company Location",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format

```

-   Salary by experience (Jesse)

```{r echo=TRUE, fig.height=6, fig.width=12}
# Load necessary libraries
library(ggplot2)
library(dplyr)

# Group by unique company_location and calculate the mean salary
salary_summary <- df %>%
  group_by(experience_level) %>%
  summarize(
    mean_salary = mean(salary_in_usd),
    sd_salary = sd(salary_in_usd)
  )
df <- df %>%
  mutate(experience_level = case_when(
    experience_level == "EN" ~ "Entry-Level",
    experience_level == "EX" ~ "Executive",
    experience_level == "SE" ~ "Senior",
    experience_level == "MI" ~ "Mid-Level",
    TRUE ~ experience_level  # Default if no match
  ))

ggplot(salary_summary, aes(x = experience_level, y = mean_salary)) +
  geom_bar(stat = "identity", fill = "red", color = "black", width = 0.7) +
  geom_errorbar(aes(ymin = mean_salary - sd_salary, ymax = mean_salary + sd_salary), width = 0.2) +
  labs(
    title = "Average Salary by Experience Level",
    x = "Experience Level",
    y = "Mean Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format

```

```{r echo=TRUE, message=TRUE, warning=TRUE}
# Reorder job titles from greatest to least based on median salary
df_filtered$job_title <- factor(df_filtered$job_title, levels = median_salaries$job_title[order(-median_salaries$median_salary)])

# Create the plot using the filtered dataframe
ggplot(df_filtered, aes(x = job_title, y = salary_in_usd)) +
  geom_boxplot(fill = "skyblue", color = "black", outlier.shape = NA) +  # Use geom_boxplot to create boxplots
  geom_jitter(data = df_filtered %>% filter(salary_in_usd < quantile(salary_in_usd, 0.25) - 1.5*IQR(salary_in_usd) | salary_in_usd > quantile(salary_in_usd, 0.75) + 1.5*IQR(salary_in_usd)), width = 0.2, color = "black", alpha = 0.5) +
  geom_hline(yintercept = median(df_filtered$salary_in_usd), color = "red", linetype = "dashed") +  # Add a dashed line for median
  labs(
    title = "Salary Distribution by Job Title",
    x = "Job Title",
    y = "Salary ($)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1)  # Rotate labels for better spacing
  ) +
  scale_y_continuous(labels = scales::comma)  # Prevent scientific notation by using comma format


```

```{r echo=TRUE}

# Convert remote_ratio to factor with specified levels
df$remote_ratio <- factor(df$remote_ratio, levels = c(0, 50, 100))
df$company_size <- factor(df$company_size, levels = c("S", "M", "L"))

# Print summary of counts for each level of company_size
cat("Counts for each level of company_size:\n")
print(summary(df$company_size))

# Print summary of counts for each level of remote_ratio
cat("\nCounts for each level of remote_ratio:\n")
print(summary(df$remote_ratio))

```


```{r echo=TRUE}

# Load necessary library
library(ggplot2)
library(scales)
library(dplyr)

# Summarize data by company_size and remote_ratio
summary_df <- df %>%
  group_by(company_size, remote_ratio) %>%
  summarize(count = n()) %>%
  mutate(prop = count / sum(count))

# Create the plot
ggplot(summary_df, aes(x = company_size, y = prop, fill = remote_ratio)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(
    title = "Distribution of Remote Ratios by Company Size",
    x = "Company Size",
    y = "Proportion of Entries"
  ) +
  scale_fill_manual(values = c("skyblue", "lightgreen", "pink")) +  # Custom color palette
  theme_minimal()

```

```{r echo=TRUE}

# Calculate count of jobs for each combination of time, remote_ratio, and company_size
job_counts <- aggregate(job_title ~ work_year + remote_ratio + company_size, data = df, FUN = length)

# Plot with faceting by company_size and free y-axis scales
ggplot(job_counts, aes(x = work_year, y = job_title, group = remote_ratio, color = remote_ratio)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Number of Jobs by Remote Ratio Over Time (by Company Size)",
    x = "Year",
    y = "Number of Jobs",
    color = "Remote Ratio"
  ) +
  scale_color_manual(values = c("pink", "green", "skyblue")) +
  theme_minimal() +
  facet_wrap(~ company_size, scales = "free_y") +  # Facet by company_size variable with free y-axis scales
  theme(axis.text.x = element_text(angle = 45, hjust = 0.5, vjust = 0.5))  # Rotate y-axis labels vertically
```

```{r echo=TRUE}


# Convert time to factor if it's not already
df$work_year <- as.factor(df$work_year)
df$work_year <- factor(df$work_year, levels = c("2020", "2021", "2022", "2023", "2024"))

# Calculate average salary for each combination of time, remote_ratio, and company_size
average_salary <- aggregate(salary_in_usd ~ work_year + remote_ratio + company_size, data = df, FUN = median)

# Plot with faceting by company_size and adjusted facet width
ggplot(average_salary, aes(x = work_year, y = salary_in_usd, group = remote_ratio, color = remote_ratio)) +
  geom_line() +
  geom_point() +
  labs(
    title = "Median Salary by Remote Ratio Over Time (by Company Size)",
    x = "Year",
    y = "Median Salary (USD)",
    color = "Remote Ratio"
  ) +
  scale_color_manual(values = c("pink", "green", "skyblue")) +
  theme_minimal() +
  facet_wrap(~ company_size, scales = "free_y") +  # Facet by company_size variable with free y-axis scales
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r echo=TRUE}
  
# Create the horizontally rotated box plot with angled x-axis labels, no legend, and custom colors
ggplot(df, aes(x = salary_in_usd, y = "", fill = remote_ratio)) +
  geom_boxplot() +
  facet_grid(company_size ~ remote_ratio, scales = "free_y") +
  labs(
    title = "Salary Distribution by Remote Ratio and Company Size",
    x = "Salary (USD)",
    y = "Remote Ratio (%)"
  ) +
  scale_x_continuous(labels = function(x) format(x, scientific = FALSE)) +
  scale_fill_manual(values = c("skyblue", "skyblue", "skyblue")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")  # Remove legend


```